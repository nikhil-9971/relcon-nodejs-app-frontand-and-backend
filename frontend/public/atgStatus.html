<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ATG Status Modal</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-white font-sans text-sm">
    <div class="p-6">
      <h2 class="text-lg font-bold mb-4 text-center text-gray-800">
        üîß ATG Status Update
      </h2>

      <form id="atgForm" class="space-y-4">
        <input type="hidden" id="planId" />

        <div>
          <label class="font-semibold">ATG Probe Status</label>
          <textarea
            id="probeStatus"
            required
            class="w-full p-2 border rounded"
            placeholder="Example: Probe Replaced at Tank 2..."
          ></textarea>
        </div>

        <div>
          <label class="font-semibold">Calibration Info</label>
          <input
            type="text"
            id="calibrationInfo"
            class="w-full p-2 border rounded"
            required
          />
        </div>

        <div>
          <label class="font-semibold">Remarks</label>
          <textarea id="remarks" class="w-full p-2 border rounded"></textarea>
        </div>

        <div class="text-right">
          <button
            type="button"
            onclick="submitATGStatus()"
            class="bg-green-600 text-white px-4 py-2 rounded"
          >
            üíæ Save
          </button>
        </div>
      </form>
    </div>

    <script>
      const baseUrl = "https://relcon-backend-jwt.onrender.com";

      function loadATGForm(planId) {
        document.getElementById("planId").value = planId;
      }

      async function submitATGStatus() {
        const payload = {
          planId: document.getElementById("planId").value,
          probeStatus: document.getElementById("probeStatus").value,
          calibrationInfo: document.getElementById("calibrationInfo").value,
          remarks: document.getElementById("remarks").value,
        };

        const res = await fetch(`${baseUrl}/atg-status`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${localStorage.getItem("token")}`,
          },
          body: JSON.stringify(payload),
        });

        if (res.ok) {
          alert("‚úÖ ATG Status saved successfully!");
          window.close(); // if using popup
        } else {
          alert("‚ùå Failed to save ATG Status");
        }
      }
    </script>
  </body>
</html>
